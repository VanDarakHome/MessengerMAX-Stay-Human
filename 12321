import json
from bosses import boss1, boss2, test
from engine import GameEngine

# Основной файл игры

def print_location(engine):
    info = engine.get_current_location_info()
    location = engine.game_map[info['id']]

    print(f"\n=== {location['name']} ===")
    print(location.get('lore', ''))

    # Если локация – финальная, завершаем
    if info['is_finish']:
        print(f"Концовка: {info['finish_type']}")
        return "finish"

    # Если в локации босс или тест
    if 'boss' in location:
        b = location['boss']
        if b == 'boss1':
            boss1().start()
        elif b == 'boss2':
            boss2().start()
        return

    if 'test' in location:
        test().start()
        return

    # Иначе выводим обычные варианты выбора
    if 'question' in location:
        print(location['question'])

    moves = engine.get_available_moves()
    for i, mv in enumerate(moves, 1):
        print(f"{i}. {mv['name']}")


def main():
    engine = GameEngine()

    while True:
        state = print_location(engine)
        if state == "finish":
            break

        moves = engine.get_available_moves()
        if not moves:
            print("Нет доступных переходов.")
            break

        choice = input("Выберите действие: ")
        if not choice.isdigit() or not (1 <= int(choice) <= len(moves)):
            print("Неверный выбор.")
            continue

        selected = moves[int(choice) - 1]['id']
        engine.move_to(selected)


if __name__ == "__main__":
    main()


